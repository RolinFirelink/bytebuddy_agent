# æœ¬æ¬¡æ›´æ–°è¯´æ˜ - è‡ªå®šä¹‰åŒ…è·¯å¾„æ”¯æŒ

## ğŸ“… æ›´æ–°æ—¥æœŸ
2024å¹´

## ğŸ¯ æ›´æ–°ç›®æ ‡
è®© ByteBuddy Agent æ”¯æŒé€šè¿‡å‘½ä»¤è¡Œå‚æ•°è‡ªå®šä¹‰è¦æ‹¦æˆªçš„åŒ…è·¯å¾„ï¼Œä½¿å…¶å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä»£ç ã€‚

## âœ¨ ä¸»è¦æ”¹åŠ¨

### 1. å‚æ•°æ ¼å¼
- **æ—§ç‰ˆæœ¬**ï¼šåŒ…è·¯å¾„ç¡¬ç¼–ç åœ¨ä»£ç ä¸­ï¼ˆå¦‚ `org.example.service`ï¼‰
- **æ–°ç‰ˆæœ¬**ï¼šé€šè¿‡å‚æ•°åŠ¨æ€æŒ‡å®šåŒ…è·¯å¾„ï¼Œæ ¼å¼ï¼š`æ¨¡å¼:åŒ…è·¯å¾„`

### 2. æ”¯æŒçš„æ¨¡å¼
æ‰€æœ‰æ‹¦æˆªæ¨¡å¼éƒ½æ”¯æŒè‡ªå®šä¹‰åŒ…è·¯å¾„ï¼š
- `package:åŒ…è·¯å¾„` - åŒ…è·¯å¾„åŒ¹é…æ‹¦æˆªå™¨
- `advice:åŒ…è·¯å¾„` - Advice æ–¹å¼æ‹¦æˆªå™¨
- `advanced:åŒ…è·¯å¾„` - é«˜çº§æ‹¦æˆªå™¨
- `all:åŒ…è·¯å¾„1,åŒ…è·¯å¾„2` - æ‰€æœ‰æ‹¦æˆªæ–¹å¼ï¼ˆæ”¯æŒå¤šä¸ªåŒ…ï¼‰

### 3. ä»£ç æ”¹åŠ¨

#### ä¿®æ”¹çš„æ–‡ä»¶
- `src/main/java/org/example/agent/AgentMain.java`

#### ä¸»è¦æ”¹åŠ¨ç‚¹
1. **å‚æ•°è§£æé€»è¾‘**ï¼šæ·»åŠ äº†å‚æ•°è§£æï¼Œæ”¯æŒ `æ¨¡å¼:åŒ…è·¯å¾„` æ ¼å¼
2. **æ–¹æ³•ç­¾åæ›´æ–°**ï¼šæ‰€æœ‰æ‹¦æˆªæ–¹æ³•éƒ½æ·»åŠ äº† `packageName` å‚æ•°
3. **é”™è¯¯å¤„ç†**ï¼šæ·»åŠ äº†å‚æ•°éªŒè¯å’Œé”™è¯¯æç¤º
4. **å¤šåŒ…æ”¯æŒ**ï¼š`all` æ¨¡å¼æ”¯æŒå¤šä¸ªåŒ…è·¯å¾„ï¼ˆé€—å·åˆ†éš”ï¼‰

## ğŸ“ ä½¿ç”¨ç¤ºä¾‹

### åŸºæœ¬ç”¨æ³•
```bash
# æ‹¦æˆªæŒ‡å®šåŒ…
java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=package:com.example.service -jar app.jar

# ä½¿ç”¨ Advice æ¨¡å¼
java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=advice:com.example.service -jar app.jar

# ä½¿ç”¨é«˜çº§æ‹¦æˆªå™¨
java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=advanced:com.example.service -jar app.jar

# æ‹¦æˆªå¤šä¸ªåŒ…
java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=all:com.example.service,com.example.dao -jar app.jar
```

## ğŸ” æ”¹åŠ¨è¯¦æƒ…

### å‚æ•°è§£æé€»è¾‘
```java
// è§£æå‚æ•°ï¼šæ”¯æŒ "æ¨¡å¼:åŒ…è·¯å¾„" æ ¼å¼
String mode = "default";
String[] packageNames = null;

if (agentArgs != null && !agentArgs.isEmpty()) {
    String[] parts = agentArgs.split(":", 2);
    mode = parts[0].toLowerCase();
    if (parts.length > 1 && !parts[1].isEmpty()) {
        // æ”¯æŒå¤šä¸ªåŒ…è·¯å¾„ï¼Œç”¨é€—å·åˆ†éš”
        packageNames = parts[1].split(",");
        for (int i = 0; i < packageNames.length; i++) {
            packageNames[i] = packageNames[i].trim();
        }
    }
}
```

### æ–¹æ³•ç­¾åæ›´æ–°
æ‰€æœ‰æ‹¦æˆªæ–¹æ³•éƒ½æ·»åŠ äº†åŒ…è·¯å¾„å‚æ•°ï¼š
- `setupPackageMatcher(AgentBuilder, String packageName)`
- `setupAdviceInterceptor(AgentBuilder, String packageName)`
- `setupAdvancedInterceptor(AgentBuilder, String packageName)`
- `setupAllInterceptors(AgentBuilder, String[] packageNames)`

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†ä½¿ç”¨è¯´æ˜**ï¼šæŸ¥çœ‹ `å‚æ•°é…ç½®ä½¿ç”¨è¯´æ˜.md`
- **åŠŸèƒ½æ–‡æ¡£**ï¼šæŸ¥çœ‹ `ByteBuddyåŠŸèƒ½æ‰©å±•è¯´æ˜æ–‡æ¡£.md`

## âœ… æµ‹è¯•å»ºè®®

1. **å•åŒ…æµ‹è¯•**
   ```bash
   java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=package:com.yourproject.service -jar your-app.jar
   ```

2. **å¤šåŒ…æµ‹è¯•**
   ```bash
   java -javaagent:bytebuddy_agent-1.0-SNAPSHOT.jar=all:com.yourproject.service,com.yourproject.dao -jar your-app.jar
   ```

3. **éªŒè¯æ‹¦æˆª**
   - æŸ¥çœ‹ Agent å¯åŠ¨æ—¥å¿—ï¼Œç¡®è®¤åŒ…è·¯å¾„é…ç½®æ­£ç¡®
   - è°ƒç”¨ç›®æ ‡åŒ…ä¸‹çš„æ–¹æ³•ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰æ‹¦æˆªæ—¥å¿—è¾“å‡º

## ğŸ‰ ä¼˜åŠ¿

1. **çµæ´»æ€§**ï¼šå¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨ï¼Œæ— éœ€ä¿®æ”¹ä»£ç 
2. **æ˜“ç”¨æ€§**ï¼šåªéœ€è°ƒæ•´å‘½ä»¤è¡Œå‚æ•°å³å¯
3. **å¯æ‰©å±•æ€§**ï¼šæ”¯æŒå¤šä¸ªåŒ…è·¯å¾„ï¼Œæ»¡è¶³å¤æ‚åœºæ™¯éœ€æ±‚
4. **é”™è¯¯æç¤º**ï¼šå‚æ•°é”™è¯¯æ—¶ä¼šç»™å‡ºæ¸…æ™°çš„æç¤ºä¿¡æ¯

---

**æ›´æ–°å®Œæˆï¼** ç°åœ¨ä½ å¯ä»¥åœ¨ä»»ä½•é¡¹ç›®ä¸­ä½¿ç”¨è¿™ä¸ªæ¢é’ˆäº†ï¼ ğŸš€

